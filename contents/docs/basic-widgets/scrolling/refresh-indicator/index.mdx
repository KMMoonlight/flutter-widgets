---
title: RefreshIndicator
description: MD风格的下拉刷新组件
---

`RefreshIndicator`是Flutter中的一个Material Design风格的下拉刷新组件，主要用于在可滚动视图(如`ListView`或`CustomScrollView`)中实现“下拉刷新”功能。当用户向下滑动内
容时，组件会触发一个刷新动画(通常显示圆形进度指示器)，并执行自定义的异步操作(如加载新数据)。其核心逻辑基于`ScrollController`监听滚动位置，在达到特定阈值时自动调用刷新回调。

### 使用场景:
- 社交应用中的动态列表更新(如刷新新帖子)。
- 新闻或博客应用的列表内容重新加载。
- 电商商品列表的实时数据同步。
- 任何需要用户手动触发数据刷新的可滚动界面。


## 示例
### 基础列表刷新
```dart
import 'package:flutter/material.dart';

class BasicRefreshExample extends StatefulWidget {
  @override
  _BasicRefreshExampleState createState() => _BasicRefreshExampleState();
}

class _BasicRefreshExampleState extends State<BasicRefreshExample> {
  List<String> items = ['Item 1', 'Item 2', 'Item 3'];

  Future<void> _handleRefresh() async {
    // 模拟网络请求延迟
    await Future.delayed(Duration(seconds: 2));
    setState(() {
      items.add('New Item ${items.length + 1}');
    });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('基础刷新示例')),
      body: RefreshIndicator(
        onRefresh: _handleRefresh, // 触发刷新的回调
        child: ListView.builder(
          itemCount: items.length,
          itemBuilder: (context, index) => ListTile(title: Text(items[index])),
        ),
      ),
    );
  }
}
```


### 自定义刷新指示器并与主题适配
```dart
RefreshIndicator(
  onRefresh: () async {
    // 自定义刷新逻辑
    await Future.delayed(Duration(seconds: 1));
  },
  color: Colors.blue, // 进度指示器颜色
  backgroundColor: Colors.grey[200], // 背景色
  displacement: 40.0, // 触发刷新的垂直位移阈值
  child: ListView(...),
)
```

### 与异步状态结合(如进行错误处理)
```dart
Future<void> _handleRefreshWithError() async {
  try {
    await api.fetchData(); // 模拟可能失败的请求
    setState(() { /* 更新数据 */ });
  } catch (e) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text('刷新失败: $e')),
    );
    // 重新抛出异常以确保RefreshIndicator显示错误状态
    throw e;
  }
}
```

## 注意点
### 常见问题与优化技巧：
- 性能瓶颈:
  - 避免在`onRefresh`中执行重量级同步操作，否则会阻塞UI线程导致动画卡顿。
  - 如果列表数据量巨大，刷新后考虑使用`ListView.separated`或`SliverList`优化渲染。
- 兼容性警告:
  - `RefreshIndicator`必须包裹可滚动组件(如`ListView`、`CustomScrollView`)，直接用于`Column`或`SingleChildScrollView`可能无法正常触发。
  - 在iOS平台上，下拉刷新行为与`Material Design`略有差异，需测试一致性。
- 最佳实践:
  - 在`onRefresh`中始终返回`Future`，确保刷新动画能正确完成或显示错误。
  - 使用`displacement`参数调整触发灵敏度，避免误触。
  - 结合`RefreshIndicator.adaptive`创建平台自适应的刷新指示器(如iOS风格)。



## 构造函数
```dart
const RefreshIndicator({
  Key? key,
  required this.child, // 必需参数：可滚动的子组件
  required this.onRefresh, // 必需参数：刷新回调（返回Future）
  this.displacement = 40.0, // 触发刷新的垂直位移（默认40逻辑像素）
  this.color, // 进度指示器颜色（默认为主题色）
  this.backgroundColor, // 背景颜色（默认为透明）
  this.notificationPredicate = defaultScrollNotificationPredicate, // 滚动通知过滤条件
  this.strokeWidth = 2.0, // 进度指示器线条宽度
  this.triggerMode = RefreshIndicatorTriggerMode.onEdge, // 触发模式（边缘或全程）
})
```


## 属性
| 属性名                 | 属性类型                         | 说明                                                                 |
|------------------------|----------------------------------|----------------------------------------------------------------------|
| `child`                | Widget                           | 必需的可滚动子组件（如ListView）。                                  |
| `onRefresh`            | `Future<void> Function()`          | 必需的回调函数，触发刷新时执行异步操作。                             |
| `displacement`         | double                           | 触发刷新的垂直位移阈值（默认40.0）。                                |
| `color`                | Color?                           | 进度指示器的颜色（默认为主题主色）。                                 |
| `backgroundColor`      | Color?                           | 刷新指示器背景颜色（默认为透明）。                                   |
| `notificationPredicate`| ScrollNotificationPredicate     | 过滤滚动通知的条件（默认检查垂直方向滚动）。                         |
| `strokeWidth`          | double                           | 进度指示器线条的宽度（默认2.0）。                                   |
| `triggerMode`          | RefreshIndicatorTriggerMode      | 触发模式，如`onEdge`（仅顶部触发）或`anywhere`（任意位置触发）。     |

### 关键属性详解: 
- `onRefresh`: 这是核心属性，必须返回`Future`。如果`Future`完成，指示器自动关闭；如果抛出异常，指示器会显示错误状态(需结合错误处理)。
- `triggerMode`: 建议在长列表中使用`onEdge`(默认)避免误触；对于短列表(内容不足一屏)，可使用`anywhere`确保可触发。
- `displacement`: 根据设备屏幕密度调整该值，例如在高分辨率设备上可适当增大以提高用户体验。
